import base64

def encode_b64(string, encoding='utf8'):
    string = string.encode(encoding)
    print(string)
    oldstr = ''
    newstr = []
    base = ''
    base64_list = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
                   'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
                   'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
                   'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', '/']
    #把原始字符串转换为二进制，用bin转换后是0b开头的，所以把b替换了，首位补0补齐8位
    for i in string:
        oldstr += '{:08}'.format(int(str(bin(i)).replace('0b', '')))
    print(oldstr, 6 - len(oldstr) % 6)
    #把转换好的二进制按照6位一组分好，最后一组不足6位的后面补0
    for j in range(0, len(oldstr), 6):
        newstr.append('{:<06}'.format(oldstr[j:j + 6]))
    print(newstr)
    #在base_list中找到对应的字符，拼接
    for l in range(len(newstr)):
        base += base64_list[int(newstr[l], 2)]
    #判断base字符结尾补几个‘=’
    if len(string) % 3 == 1:
        base += '=='
    elif len(string) % 3 == 2:
        base += '='
    return base


def decode_b64(string_, encoding='utf8'):
    base64_list = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
                   'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
                   'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
                   'w', 'x', 'y', 'z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '+', '/']
    byt = bytearray()
    r_num = string_.count('=')
    if r_num:
        string_ = string_[:-r_num]
    bin_list = ['{:>06}'.format(bin(base64_list.index(s)).replace('0b', '')) for s in string_]
    print(bin_list)
    bin_str = ''.join(bin_list)
    bin_str = bin_str[:len(bin_str)-r_num*2]
    print(bin_str)
    for index in range(0, len(bin_str), 8):
        byt.append(int(bin_str[index:index+8], 2))

    print(byt)
    print(byt.decode(encoding))


s = encode_b64('中国s', 'gbk')
print(s)
decode_b64(s, 'gbk')

# for i in range(30000):
#     print(chr(i))

